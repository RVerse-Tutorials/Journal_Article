---
title: 'Appendices: Use of satellite data for understanding and predicting oil sardine
  (*Sardinella longiceps*) catch variability along the southwest coast of India'
date: '`r format(Sys.time(), "%d %B, %Y")`'
output:
  pdf_document: default
  html_document: default
  word_document: default
header-includes: \usepackage[labelformat=empty]{caption}
---

```{r child = 'setup.Rmd'}
```

# Appendix A: Tests for prior season catch as covariate

```{r child = 'Table App A spawner model.Rmd'}
```

#

```{r, results="asis", echo=FALSE}
cat("\\clearpage")
```

```{r child = 'Table App A nonspawner model.Rmd'}
```

#

```{r, results="asis", echo=FALSE}
cat("\\clearpage")
```

# Appendix B: Tests for environmental variables as covariates

```{r child = 'Table App B spawner covariates.Rmd'}
```

#

```{r, results="asis", echo=FALSE}
cat("\\clearpage")
```

```{r child = 'Table App B nonspawner covariates.Rmd'}
```

#

```{r, results="asis", echo=FALSE}
cat("\\clearpage")
```

# Appendix C: Tests for Chlorophyll-a as a covariate

```{r child = 'Table App C chlorophyll.Rmd'}
```

```{r, results="asis", echo=FALSE}
cat("\\clearpage")
```

# Appendix D: Correlation of covariates across the boxes

```{r cov-correlation, fig.cap="Figure C1. Correlation of the covariates across boxes.  Correlation is shown by the width of the lines between neighboring boxes.",fig.width=5.5,message=FALSE,warning=FALSE, echo=FALSE}
library(maps)
library(mapdata)
par(mfrow=c(2,2),mar=c(0,1,1,1))
for(k in 1:4){
  vari=c("PrecipTRMM","CHL.","SST.","SSH.")[k]
  var.title=c("Precipitation","Chlorophyll","SST","SSH")[k]
  a=makedat(covname=vari) #create anomalies for all boxes
a=a[,paste(vari,1:14,sep="")]
corra=cor(na.omit(a))
mymap=map('worldHires','india',xlim=c(73,80),ylim=c(7,14),col="blue",lwd=2)
botlats=c(12:8,12:8,9,8,8); toplats=botlats+1
cenlats=botlats+.5
tmp= c(74.2,74.9,75.3,75.5,76.3)     
leftlons=c(tmp,tmp-1,73.5,74.3,73.3);rightlons=leftlons+1
cenlons=leftlons+.5
#plot the polygons
for(i in 1:13){
botlat=botlats[i]; toplat=botlat+1
leftlon=leftlons[i]; rightlon=leftlon+1
y=c(botlat,toplat,toplat,botlat,botlat)
x=c(leftlon,leftlon,rightlon,rightlon,leftlon)
polygon(x,y)
}

breaks=seq(0,1,.2)
wids=c(0,0,2,3,4)
neighbors=matrix(c(
  1, 2, 
  1, 6,
  1, 7,
  2, 3,
  2, 7,
  2, 8,
  3, 4,
  3, 8,
  3, 9,
  4, 5,
  4, 9,
  4, 10,
  5, 10,
  6, 7,
  7, 8,
  8, 9,
  8, 11,
  9, 10,
  9, 11,
  9, 12,
  10, 12,
  11, 12,
  11, 13,
  12, 13),ncol=2,byrow=TRUE) 
for(i in 1:nrow(neighbors)){
  from=neighbors[i,1]
  to=neighbors[i,2]
  val=corra[from,to]
  col=ifelse(val<0,"red","black")
  wid=wids[as.numeric(cut(abs(val),breaks))]
  if(wid!=0) lines(cenlons[c(from,to)],cenlats[c(from,to)],col=col,lwd=wid)
}
title(var.title)
}
```

# Appendix E: Covariates along the SE India coast

```{r upw.mon, echo=FALSE,fig.cap="Figure E1. Upwelling index.", fig.width=8,fig.height=8,message=FALSE,warning=FALSE}
### FIGURE Upwelling
oldpar=par(mfrow=c(2,2), mar=c(2,5,2,0))
for(i in 2:5){
  covname=paste("SST.UPW.",i,sep="")
dat=seio_covariates_mon[[covname]]
datmon=seio_covariates_mon$Month
datts=ts(dat,start=1956, frequency=12)
plot(datts,ylab=paste("SST Upwelling Index Box",i),xlab="",bty="n",ylim=c(-2,5),xlim=c(1960,2015))
#lines(ts(filter(dat,rep(1,24))/24,start=1956,frequency=12),lwd=2,col="red")
}
for(i in 2:5){
  covname=paste("SST.UPW.",i,sep="")
dat=seio_covariates_mon[[covname]]
datmon=seio_covariates_mon$Month
if(i==2) oldpar=par(fig = c(0.05, .25, 0.8, 1), new = T)  
if(i==3) oldpar=par(fig = c(0.05+.5, .25+.5, 0.8, 1), new = T)  
if(i==4) oldpar=par(fig = c(0.05, .25, 0.8-.5, 1-.5), new = T)  
if(i==5) oldpar=par(fig = c(0.05+.5, .25+.5, 0.8-.5, 1-.5), new = T)  
catchmeans=tapply(dat, datmon, mean, na.rm=TRUE)
names(catchmeans)=1:12
barplot(catchmeans,ylab="",cex.axis=.75,cex.names=.75,ylim=c(0,2), col="grey", xaxt="n")
title("Mean Mthly\nIndex",cex.main=.75)
}
library(maps)
library(mapdata)
 mymap=map('worldHires','india',xlim=c(74.5,80),ylim=c(7,14),plot=FALSE)
  botlats=c(12:8,12:8,9,8,8); toplats=botlats+1
  cenlats=botlats+.5
  tmp= c(74.2,74.9,75.3,75.5,76.3)     
  leftlons=c(tmp,tmp-1,73.5,74.3,73.3);rightlons=leftlons+1
  cenlons=leftlons+.5
for(i in 2:5){
  if(i==2) oldpar=par(fig = c(0.05, .25, .55, .75), new = T)  
if(i==3) oldpar=par(fig = c(0.05+.5, .25+.5, .55, .75), new = T)  
if(i==4) oldpar=par(fig = c(0.05, .25, 0.05, .25), new = T)  
if(i==5) oldpar=par(fig = c(0.05+.5, .25+.5, 0.05, .25), new = T)  
   plot(mymap$x,mymap$y,type="l",bty="n",xaxt="n",yaxt="n",ylab="",xlab="")
    botlat=botlats[i]; toplat=botlat+1
    leftlon=leftlons[i]; rightlon=leftlon+1
    y=c(botlat,toplat,toplat,botlat,botlat)
    x=c(leftlon,leftlon,rightlon,rightlon,leftlon)
    polygon(x,y)
  }
par(oldpar)
```

#

```{r, results="asis", echo=FALSE}
cat("\\clearpage")
```

```{r chl.mon, echo=FALSE,fig.cap="Figure E2. Chlorophyll-a.", fig.width=8,fig.height=8,message=FALSE,warning=FALSE}
### FIGURE CHL
oldpar=par(mfrow=c(2,2), mar=c(2,5,2,0))
for(i in 2:5){
  covname=paste("CHL.",i,sep="")
dat=seio_covariates_mon[[covname]]
datmon=seio_covariates_mon$Month
datts=ts(dat,start=1956, frequency=12)
plot(datts,ylab=paste("Surface Chl-a Box",i),xlab="",bty="n",ylim=c(0,35),xlim=c(1980,2020))
#lines(ts(filter(dat,rep(1,24))/24,start=1956,frequency=12),lwd=2,col="red")
}
for(i in 2:5){
  covname=paste("CHL.",i,sep="")
dat=seio_covariates_mon[[covname]]
datmon=seio_covariates_mon$Month
if(i==2) oldpar=par(fig = c(0.05, .25, 0.8, 1), new = T)  
if(i==3) oldpar=par(fig = c(0.05+.5, .25+.5, 0.8, 1), new = T)  
if(i==4) oldpar=par(fig = c(0.05, .25, 0.8-.5, 1-.5), new = T)  
if(i==5) oldpar=par(fig = c(0.05+.5, .25+.5, 0.8-.5, 1-.5), new = T)  
catchmeans=tapply(dat, datmon, mean, na.rm=TRUE)
names(catchmeans)=1:12
barplot(catchmeans,ylab="",cex.axis=.75,cex.names=.75,ylim=c(0,12),col="grey", xaxt="n")
title("Mean Mthly\nChl-a",cex.main=.75)
}
library(maps)
library(mapdata)
 mymap=map('worldHires','india',xlim=c(74.5,80),ylim=c(7,14),plot=FALSE)
  botlats=c(12:8,12:8,9,8,8); toplats=botlats+1
  cenlats=botlats+.5
  tmp= c(74.2,74.9,75.3,75.5,76.3)     
  leftlons=c(tmp,tmp-1,73.5,74.3,73.3);rightlons=leftlons+1
  cenlons=leftlons+.5
for(i in 2:5){
  if(i==2) oldpar=par(fig = c(0.05, .25, .55, .75), new = T)  
if(i==3) oldpar=par(fig = c(0.05+.5, .25+.5, .55, .75), new = T)  
if(i==4) oldpar=par(fig = c(0.05, .25, 0.05, .25), new = T)  
if(i==5) oldpar=par(fig = c(0.05+.5, .25+.5, 0.05, .25), new = T)  
plot(mymap$x,mymap$y,type="l",bty="n",xaxt="n",yaxt="n",ylab="",xlab="")
    botlat=botlats[i]; toplat=botlat+1
    leftlon=leftlons[i]; rightlon=leftlon+1
    y=c(botlat,toplat,toplat,botlat,botlat)
    x=c(leftlon,leftlon,rightlon,rightlon,leftlon)
    polygon(x,y)
  }
par(oldpar)
```

#

```{r, results="asis", echo=FALSE}
cat("\\clearpage")
```

# Appendix F: Comparison of land and oceanic rainfall measurements

```{r rainfall.mon, echo=FALSE,fig.cap="Figure F1", fig.width=8,fig.height=8,message=FALSE,warning=FALSE}
par(mfrow=c(2,1), mar=c(2,5,2,2))
dat=seio_covariates_mon$Precip.Kerala
datmon=seio_covariates_mon$Month
datts=ts(dat,start=1956, frequency=12)
plot(datts,ylab="Monthly precipitation over land (mm)",xlab="",bty="n")

dat=seio_covariates_mon$precip.gpcp.kerala
datts=ts(dat,start=1956, frequency=12)
plot(datts,ylab="Monthly precipitation off Kerala coast",xlab="",bty="n")

#lines(ts(filter(dat,rep(1,24))/24,start=1956,frequency=12),lwd=2)
oldpar=par(fig = c(0.5, .93, 0.8, 1), new = T)  
dat=seio_covariates_mon$Precip.Kerala
catchmeans=tapply(dat, datmon, mean, na.rm=TRUE)
names(catchmeans)=1:12
barplot(catchmeans,ylab="",cex.axis=.75,cex.names=.75, col="grey", xaxt="n")
title("Mean Monthly Precip",cex.main=.75)
par(oldpar)

dat=seio_covariates_mon$precip.gpcp.kerala
oldpar=par(fig = c(0.5, .93, .3, .5), new = T)  
catchmeans=tapply(dat, datmon, mean, na.rm=TRUE)
names(catchmeans)=1:12
barplot(catchmeans,ylab="", cex.axis=.75,cex.names=.75, col="grey", xaxt="n")
title("Mean Monthly Precip",cex.main=.75)

par(oldpar)
```

#

```{r, results="asis", echo=FALSE}
cat("\\clearpage")
```

```{r rainfall.mon.comparison, echo=FALSE,fig.cap="Figure F2. Monthly precipitation measured over land via land gauges versus the precipitation measured via remote sensing over the ocean.", fig.width=6,fig.height=6,message=FALSE,warning=FALSE}
plot(seio_covariates_mon$Precip.Kerala, seio_covariates_mon$precip.gpcp.kerala, ylab="land precipitation",
xlab="ocean precipitation")
```

# Appendix G: Chlorophyll-a images in 2016

```{r fig-chl-2016, out.width = "400px", fig.align='center', echo=FALSE, fig.cap=paste("Figure",  ref("fig:CHL")), message=FALSE, warning=FALSE}
figfile = system.file("docs", "2016 CHL.png", package="SardineForecast")
knitr::include_graphics(figfile)
```

#


