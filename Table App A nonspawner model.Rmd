---
title: "Table A2 a-c"
output:
  pdf_document: default
  word_document: default
---

```{r setup-tableA2, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
require(SardineForecast)
require(stringr)
require(mgcv)
require(knitr)
# If this is being called from another Rmd (as a child), this counter will exist
if(!exists(".rmdenvir")) .rmdenvir = environment()
```

```{r setup-data-tableA2, echo=FALSE}
Qtr=3 # start of season
reg="Kerala"
respdat=data.frame(
  spawners0=oilsardine_qtr[[reg]][oilsardine_qtr$Qtr==3]
  )
catch0=filter(oilsardine_qtr[[reg]],c(1,1,1,1),sides=1)[seq(6,dim(oilsardine_qtr)[1],4)]
respdat$Catch0 = c(catch0,NA)
#add Catch - spawners
respdat$nspawners0 = respdat$Catch0 - respdat$spawners0

respdat=log(respdat)

covnames=c(
  "log.CHL.3","log.CHL.4","log.CHL.5",
  "log.CHL.3","log.CHL.4","log.CHL.5",
  "log.CHL.3","log.CHL.4","log.CHL.5",
  "log.CHL.3","log.CHL.4","log.CHL.5",
  "SST.UPW.3","SST.UPW.4","SST.UPW.5",
  "SST.UPW.3","SST.UPW.4","SST.UPW.5",
  "SST.UPW.3","SST.UPW.4","SST.UPW.5",
  "SST.UPW.3","SST.UPW.4","SST.UPW.5",
  "SST.3","SST.4","SST.5",
  "SST.3","SST.4","SST.5",
  "SST.3","SST.4","SST.5",
  "SST.3","SST.4","SST.5")
covmon=list(
  1:3, 1:3, 1:3,
  6:10, 6:10, 6:10,
  6:7,6:7,6:7,
  7:12, 7:12, 7:12,
  1:3, 1:3, 1:3,
  6:10, 6:10, 6:10,
  6:7,6:7,6:7,
  7:12, 7:12, 7:12,
  1:3, 1:3, 1:3,
  6:10, 6:10, 6:10,
  6:7,6:7,6:7,
  7:12, 7:12, 7:12
  )
n=2 #max lag in cov to use
for(i in 1:length(covnames)){
  covname=covnames[i]
  mon=covmon[[i]]
  varname=paste(covname,".mon",mon[1],"to",mon[length(mon)],".0",sep="")
  covdat=tapply(seio_covariates_mon[[covname]],seio_covariates_mon$Year,function(x){mean(x[mon],na.rm=TRUE)})
  if(str_detect(covname, "mon1to3")){
    respdat[[varname]]=c(covdat[-1],NA)
  }else{
    respdat[[varname]]=covdat
  }
}
#add lags
for(i in colnames(respdat)){
  name=paste(str_sub(i, 1, str_length(i)-1),"1",sep="")
  respdat[[name]]=c(NA,respdat[[i]][1:(dim(respdat)[1]-1)])
  name=paste(str_sub(i, 1, str_length(i)-1),"2",sep="")
  respdat[[name]] = c(NA,NA,respdat[[i]][1:(dim(respdat)[1]-2)])
}
respdat$Year=oilsardine_qtr$Year[oilsardine_qtr$Qtr==Qtr]

fullrespdat = respdat
```

```{r seltableA2a, echo=FALSE}
respdat = fullrespdat[which(fullrespdat$Year==1982):which(fullrespdat$Year==2015),]

#set up table
seltable = data.frame(Model=paste("Time dependency test A ", min(respdat$Year),"-", max(respdat$Year), " data", sep=""), Residual.df="", Residual.dev="", F="", p.value="", AIC="", stringsAsFactors=FALSE)

#5 is most complex
m5 = gam(nspawners0 ~ spawners1+spawners2, data=respdat)
m0=m5
m1 = gam(nspawners0 ~ 1, data=m0$model)
m2 = gam(nspawners0 ~ spawners1, data=m0$model)
m3 = gam(nspawners0 ~ spawners1 + spawners2, data=m0$model)
a=anova(m1,m2,m3, test="F")

#simple level model
i=1; mod=paste("m",i,sep="")
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F="", p.value="", AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;(Var($\\epsilon$) = ", round(get(mod)$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#linear ln NS_t
i=2; mod=paste("m",i,sep="")
aa = summary(get(mod))
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $\\beta ln(S_{t-1})$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F=round(a$F[i],digits=2), p.value=round(a[["Pr(>F)"]][i], digits=3), AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;($R^2 adj$ = ",100*round(aa$r.sq, digits=2), "%, Var($\\epsilon$) = ", round(m3$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value ="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#linear ln Catch1 + ln Catch2
i=3; mod=paste("m",i,sep="")
aa = summary(get(mod))
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $\\beta_1 ln(S_{t-1})$ + $\\beta_2 ln(S_{t-2})$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F=round(a$F[i],digits=2), p.value=round(a[["Pr(>F)"]][i], digits=3), AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;($R^2 adj$ = ",100*round(aa$r.sq, digits=2), "%, Var($\\epsilon$) = ", round(m3$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value ="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

## Space
tmp1 = data.frame(Model="&nbsp;", Residual.df="&nbsp;", Residual.dev="&nbsp;", F="&nbsp;", p.value="&nbsp;", AIC="")
tmp2 = data.frame(Model=paste("Time dependency test B ", min(respdat$Year),"-", max(respdat$Year), " data", sep=""), Residual.df="", Residual.dev="", F="", p.value="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#5 is most complex
m5 = gam(nspawners0 ~ nspawners1+nspawners2, data=respdat)
m0=m5
m1 = gam(nspawners0 ~ 1, data=m0$model)
m2 = gam(nspawners0 ~ nspawners1, data=m0$model)
m3 = gam(nspawners0 ~ nspawners1 + nspawners2, data=m0$model)
a=anova(m1,m2,m3, test="F")

#simple level model
i=1; mod=paste("m",i,sep="")
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F="", p.value="", AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;(Var($\\epsilon$) = ", round(get(mod)$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#linear ln NS_t
i=2; mod=paste("m",i,sep="")
aa = summary(get(mod))
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $\\beta ln(NS_{t-1})$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F=round(a$F[i],digits=2), p.value=round(a[["Pr(>F)"]][i], digits=3), AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;($R^2 adj$ = ",100*round(aa$r.sq, digits=2), "%, Var($\\epsilon$) = ", round(m3$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value ="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#linear ln Catch1 + ln Catch2
i=3; mod=paste("m",i,sep="")
aa = summary(get(mod))
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $\\beta_1 ln(NS_{t-1})$ + $\\beta_2 ln(NS_{t-2})$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F=round(a$F[i],digits=2), p.value=round(a[["Pr(>F)"]][i], digits=3), AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;($R^2 adj$ = ",100*round(aa$r.sq, digits=2), "%, Var($\\epsilon$) = ", round(m3$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value ="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

## Space
tmp1 = data.frame(Model="&nbsp;", Residual.df="&nbsp;", Residual.dev="&nbsp;", F="&nbsp;", p.value="&nbsp;", AIC="")
tmp2 = data.frame(Model=paste("Time dependency test C ", min(respdat$Year),"-", max(respdat$Year), " data", sep=""), Residual.df="", Residual.dev="", F="", p.value="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#5 is most complex
m5 = gam(nspawners0 ~ nspawners1+spawners1, data=respdat)
m0=m5
m1 = gam(nspawners0 ~ 1, data=m0$model)
m2 = gam(nspawners0 ~ nspawners1, data=m0$model)
m3 = gam(nspawners0 ~ nspawners1 + spawners1, data=m0$model)
a=anova(m1,m2,m3, test="F")

#linear ln NS_t
i=2; mod=paste("m",i,sep="")
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $\\beta ln(NS_{t-1})$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F="", p.value="", AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;(Var($\\epsilon$) = ", round(get(mod)$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#linear ln NS1 + ln S1
i=3; mod=paste("m",i,sep="")
aa = summary(get(mod))
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $\\beta_1 ln(NS_{t-1})$ + $\\beta_2 ln(S_{t-1})$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F=round(a$F[i],digits=2), p.value=round(a[["Pr(>F)"]][i], digits=3), AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;($R^2 adj$ = ",100*round(aa$r.sq, digits=2), "%, Var($\\epsilon$) = ", round(m3$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value ="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#5 is most complex
m5 = gam(nspawners0 ~ nspawners1+spawners2, data=respdat)
m0=m5
m1 = gam(nspawners0 ~ 1, data=m0$model)
m2 = gam(nspawners0 ~ nspawners1, data=m0$model)
m3 = gam(nspawners0 ~ nspawners1 + spawners2, data=m0$model)
a=anova(m1,m2,m3, test="F")

#linear ln NS1 + ln S2
i=3; mod=paste("m",i,sep="")
aa = summary(get(mod))
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $\\beta_1 ln(NS_{t-1})$ + $\\beta_2 ln(S_{t-2})$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F=round(a$F[i],digits=2), p.value=round(a[["Pr(>F)"]][i], digits=3), AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;($R^2 adj$ = ",100*round(aa$r.sq, digits=2), "%, Var($\\epsilon$) = ", round(m3$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value ="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)
```

```{r print-tableA2a, echo=FALSE}
colnames(seltable)=c("Model", "Residual df", "Residual deviance", "F", "p value", "AIC")
if(knitr::opts_knit$get("rmarkdown.pandoc.to")=="latex") colnames(seltable)=c("Model", "\\shortstack{Residual\\\\df}", "\\shortstack{Residual\\\\deviance}", "F", "\\shortstack{p\\\\value}", "AIC")

thecap=paste("Model selection tests of time-dependency the $NS_t$ model using F-tests of nested models fit to log landings data.  $NS_t$ is the catch during the non-spawning period (Qtrs 3, 1 and 2: Oct-Jun) of season $t$ (Jul-Jun). $S_{t-1}$ and $NS_{t-1}$ are the catch during the prior sardine season during and after the spawning period respectively. $S_{t-2}$ and $NS_{t-2}$ are the same for two seasons prior.  Test A uses catch during the spawning period as the explanatory variable.  Test B uses catch during the non-spawning period as the explanatory variable.  Test C uses both. For Test C, the nestedness is lines 1-3 and lines 1-2 and 4.")
fullcap=paste("Table ", ref("tabappA:nonspawner-model-time-a", pre="A"), ". ", thecap, sep="")
kable(seltable, align="lccccc", caption=fullcap)
```

#

#

```{r, results="asis", echo=FALSE}
cat("\\clearpage")
```


```{r seltableA2b, echo=FALSE}
respdat = fullrespdat[which(fullrespdat$Year==1982):which(fullrespdat$Year==2015),]

#set up table
seltable = data.frame(Model=paste("Time dependency test A ", min(respdat$Year),"-", max(respdat$Year), " data", sep=""), Residual.df="", Residual.dev="", F="", p.value="", AIC="", stringsAsFactors=FALSE)

#5 is most complex
m5 = gam(nspawners0 ~ spawners1+spawners2, data=respdat)
m0=m5
m1 = gam(nspawners0 ~ 1, data=m0$model)
m2 = gam(nspawners0 ~ s(spawners1, sp=0.6), data=m0$model)
m3 = gam(nspawners0 ~ s(spawners1, sp=0.6) + s(spawners2, sp=0.6), data=m0$model)
a=anova(m1,m2,m3, test="F")

#simple level model
i=1; mod=paste("m",i,sep="")
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F="", p.value="", AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;(Var($\\epsilon$) = ", round(get(mod)$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#linear ln NS_t
i=2; mod=paste("m",i,sep="")
aa = summary(get(mod))
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $s(ln(S_{t-1}))$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F=round(a$F[i],digits=2), p.value=round(a[["Pr(>F)"]][i], digits=3), AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;($R^2 adj$ = ",100*round(aa$r.sq, digits=2), "%, Var($\\epsilon$) = ", round(m3$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value ="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#linear ln Catch1 + ln Catch2
i=3; mod=paste("m",i,sep="")
aa = summary(get(mod))
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $s_1(ln(S_{t-1}))$ + $s_2(ln(S_{t-2}))$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F=round(a$F[i],digits=2), p.value=round(a[["Pr(>F)"]][i], digits=3), AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;($R^2 adj$ = ",100*round(aa$r.sq, digits=2), "%, Var($\\epsilon$) = ", round(m3$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value ="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

## Space
tmp1 = data.frame(Model="&nbsp;", Residual.df="&nbsp;", Residual.dev="&nbsp;", F="&nbsp;", p.value="&nbsp;", AIC="")
tmp2 = data.frame(Model=paste("Time dependency test B ", min(respdat$Year),"-", max(respdat$Year), " data", sep=""), Residual.df="", Residual.dev="", F="", p.value="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#5 is most complex
m5 = gam(nspawners0 ~ nspawners1+nspawners2, data=respdat)
m0=m5
m1 = gam(nspawners0 ~ 1, data=m0$model)
m2 = gam(nspawners0 ~ s(nspawners1, sp=0.6), data=m0$model)
m3 = gam(nspawners0 ~ s(nspawners1, sp=0.6) + s(nspawners2, sp=0.6), data=m0$model)
a=anova(m1,m2,m3, test="F")

#simple level model
i=1; mod=paste("m",i,sep="")
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F="", p.value="", AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;(Var($\\epsilon$) = ", round(get(mod)$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#linear ln NS_t
i=2; mod=paste("m",i,sep="")
aa = summary(get(mod))
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $s(ln(NS_{t-1}))$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F=round(a$F[i],digits=2), p.value=round(a[["Pr(>F)"]][i], digits=3), AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;($R^2 adj$ = ",100*round(aa$r.sq, digits=2), "%, Var($\\epsilon$) = ", round(m3$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value ="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#linear ln Catch1 + ln Catch2
i=3; mod=paste("m",i,sep="")
aa = summary(get(mod))
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $s_1(ln(NS_{t-1}))$ + $s_2(ln(NS_{t-2}))$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F=round(a$F[i],digits=2), p.value=round(a[["Pr(>F)"]][i], digits=3), AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;($R^2 adj$ = ",100*round(aa$r.sq, digits=2), "%, Var($\\epsilon$) = ", round(m3$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value ="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

## Space
tmp1 = data.frame(Model="&nbsp;", Residual.df="&nbsp;", Residual.dev="&nbsp;", F="&nbsp;", p.value="&nbsp;", AIC="")
tmp2 = data.frame(Model=paste("Time dependency test C ", min(respdat$Year),"-", max(respdat$Year), " data", sep=""), Residual.df="", Residual.dev="", F="", p.value="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#5 is most complex
m5 = gam(nspawners0 ~ nspawners1+spawners1, data=respdat)
m0=m5
m1 = gam(nspawners0 ~ 1, data=m0$model)
m2 = gam(nspawners0 ~ s(nspawners1, sp=0.6), data=m0$model)
m3 = gam(nspawners0 ~ s(nspawners1, sp=0.6) + s(spawners1, sp=0.6), data=m0$model)
a=anova(m1,m2,m3, test="F")

#nonlinear ln NS_t
i=2; mod=paste("m",i,sep="")
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $s(ln(NS_{t-1}))$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F="", p.value="", AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;(Var($\\epsilon$) = ", round(get(mod)$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#nonlinear ln NS1 + ln S1
i=3; mod=paste("m",i,sep="")
aa = summary(get(mod))
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $s_1(ln(NS_{t-1}))$ + $s_2(ln(S_{t-1}))$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F=round(a$F[i],digits=2), p.value=round(a[["Pr(>F)"]][i], digits=3), AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;($R^2 adj$ = ",100*round(aa$r.sq, digits=2), "%, Var($\\epsilon$) = ", round(m3$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value ="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#5 is most complex
m5 = gam(nspawners0 ~ nspawners1+spawners2, data=respdat)
m0=m5
m1 = gam(nspawners0 ~ 1, data=m0$model)
m2 = gam(nspawners0 ~ s(nspawners1, sp=0.6), data=m0$model)
m3 = gam(nspawners0 ~ s(nspawners1, sp=0.6) + s(spawners2, sp=0.6), data=m0$model)
a=anova(m1,m2,m3, test="F")

#linear ln NS1 + ln S2
i=3; mod=paste("m",i,sep="")
aa = summary(get(mod))
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $s_1(ln(NS_{t-1}))$ + $s_2(ln(S_{t-2}))$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F=round(a$F[i],digits=2), p.value=round(a[["Pr(>F)"]][i], digits=3), AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;($R^2 adj$ = ",100*round(aa$r.sq, digits=2), "%, Var($\\epsilon$) = ", round(m3$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value ="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)
```

```{r print-table2Ab, echo=FALSE}
colnames(seltable)=c("Model", "Residual df", "Residual deviance", "F", "p value", "AIC")
if(knitr::opts_knit$get("rmarkdown.pandoc.to")=="latex") colnames(seltable)=c("Model", "\\shortstack{Residual\\\\df}", "\\shortstack{Residual\\\\deviance}", "F", "\\shortstack{p\\\\value}", "AIC")

thecap=paste("Model selection tests of time-dependency the $NS_t$ model using non-linear responses instead of linear responses as in Table",ref("tabappA:nonspawner-model-time-a", pre="A"), "See Table",ref("tabappA:nonspawner-model-time-a", pre="A"), "for an explanation of the parameters and model set-up.")
fullcap=paste("Table ", ref("tabappA:nonspawner-model-time-b", pre="A"), ". ", thecap, sep="")
kable(seltable, align="lccccc", caption=fullcap)
```


#

#

```{r, results="asis", echo=FALSE}
cat("\\clearpage")
```


```{r seltableA2c, echo=FALSE}
respdat = fullrespdat[which(fullrespdat$Year==1956):which(fullrespdat$Year==2015),]

#set up table
seltable = data.frame(Model=paste("Time dependency test B linear ", min(respdat$Year),"-", max(respdat$Year), " data", sep=""), Residual.df="", Residual.dev="", F="", p.value="", AIC="", stringsAsFactors=FALSE)

#5 is most complex
m5 = gam(nspawners0 ~ nspawners1+nspawners2, data=respdat)
m0=m5
m1 = gam(nspawners0 ~ 1, data=m0$model)
m2 = gam(nspawners0 ~ nspawners1, data=m0$model)
m3 = gam(nspawners0 ~ nspawners1 + nspawners2, data=m0$model)
a=anova(m1,m2,m3, test="F")

#simple level model
i=1; mod=paste("m",i,sep="")
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F="", p.value="", AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;(Var($\\epsilon$) = ", round(get(mod)$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#linear ln NS_t
i=2; mod=paste("m",i,sep="")
aa = summary(get(mod))
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $\\beta ln(NS_{t-1})$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F=round(a$F[i],digits=2), p.value=round(a[["Pr(>F)"]][i], digits=3), AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;($R^2 adj$ = ",100*round(aa$r.sq, digits=2), "%, Var($\\epsilon$) = ", round(m3$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value ="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#linear ln Catch1 + ln Catch2
i=3; mod=paste("m",i,sep="")
aa = summary(get(mod))
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $\\beta_1 ln(NS_{t-1})$ + $\\beta_2 ln(NS_{t-2})$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F=round(a$F[i],digits=2), p.value=round(a[["Pr(>F)"]][i], digits=3), AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;($R^2 adj$ = ",100*round(aa$r.sq, digits=2), "%, Var($\\epsilon$) = ", round(m3$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value ="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

## Space
tmp1 = data.frame(Model="&nbsp;", Residual.df="&nbsp;", Residual.dev="&nbsp;", F="&nbsp;", p.value="&nbsp;", AIC="")
tmp2 = data.frame(Model=paste("Linearity test ", min(respdat$Year),"-", max(respdat$Year), " data", sep=""), Residual.df="", Residual.dev="", F="", p.value="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#5 is most complex
m5 = gam(nspawners0 ~ nspawners1+nspawners2, data=respdat)
m0=m5
m1 = gam(nspawners0 ~ 1, data=m0$model)
m2 = gam(nspawners0 ~ nspawners1, data=m0$model)
m3 = gam(nspawners0 ~ s(nspawners1, sp=0.6), data=m0$model)
m4 = gam(nspawners0 ~ s(nspawners1, sp=0.6)+s(nspawners2, sp=0.6), data=m0$model)
a=anova(m1,m2,m3,m4, test="F")

#linear ln NS_t
i=2; mod=paste("m",i,sep="")
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $\\beta ln(NS_{t-1})$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F="", p.value="", AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;(Var($\\epsilon$) = ", round(get(mod)$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#non linear ln Catch1
i=3; mod=paste("m",i,sep="")
aa = summary(get(mod))
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $s(ln(NS_{t-1}))$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F=round(a$F[i],digits=2), p.value=round(a[["Pr(>F)"]][i], digits=3), AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;($R^2 adj$ = ",100*round(aa$r.sq, digits=2), "%, Var($\\epsilon$) = ", round(m3$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value ="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)

#linear ln Catch1 + ln Catch2
i=4; mod=paste("m",i,sep="")
aa = summary(get(mod))
tmp1=data.frame(Model="$ln(NS_t)$ = $\\alpha$ + $s_1(ln(NS_{t-1}))$ + $s_2(ln(NS_{t-2}))$ + $\\epsilon$", Residual.df=round(a[["Resid. Df"]][i],digits=1), Residual.dev=round(a[["Resid. Dev"]][i],digits=2), F=round(a$F[i],digits=2), p.value=round(a[["Pr(>F)"]][i], digits=3), AIC=round(AIC(get(mod)), digits=2))
tmp2=data.frame(Model=paste("&nbsp;&nbsp;&nbsp;($R^2 adj$ = ",100*round(aa$r.sq, digits=2), "%, Var($\\epsilon$) = ", round(m3$sig2, digits=2),")", sep=""), Residual.df="", Residual.dev="", F="", p.value ="", AIC="")
seltable=rbind(seltable,tmp1,tmp2)
```

```{r print-table2Ac, echo=FALSE}
colnames(seltable)=c("Model", "Residual df", "Residual deviance", "F", "p value", "AIC")
if(knitr::opts_knit$get("rmarkdown.pandoc.to")=="latex") colnames(seltable)=c("Model", "\\shortstack{Residual\\\\df}", "\\shortstack{Residual\\\\deviance}", "F", "\\shortstack{p\\\\value}", "AIC")

thecap=paste("Model selection tests of time-dependency for the $NS_t$ model using 1956-2015 data.  See Table",ref("tabappA:nonspawner-model-time-a", pre="A"),"for definitions.")
fullcap=paste("Table ", ref("tabappA:nonspawner-model-time-c", pre="A"), ". ", thecap, sep="")
kable(seltable, align="lccccc", caption=fullcap)
```



